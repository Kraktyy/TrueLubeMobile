<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Oil Change Estimator</title>
<style>
  body { font-family: Arial, sans-serif; max-width:700px; margin:auto; padding:20px; }
  label, select, button { display:block; margin:10px 0; }
  button { background:#0D47A1; color:white; padding:10px 20px; border:none; border-radius:5px; cursor:pointer; }
  #result { margin-top:20px; font-weight:bold; font-size:16px; }
</style>
</head>
<body>

<h2 style="text-align:center;">Oil Change Estimator</h2>

<label for="year">Year:</label>
<select id="year"><option value="">Select Year</option></select>

<label for="make">Make:</label>
<select id="make" disabled><option value="">Select Make</option></select>

<label for="model">Model:</label>
<select id="model" disabled><option value="">Select Model</option></select>

<label for="oilType">Oil Type:</label>
<select id="oilType">
  <option value="Conventional">Conventional</option>
  <option value="Semi">Semi-Synthetic</option>
  <option value="Full">Full Synthetic</option>
  <option value="HighMileage">High Mileage</option>
</select>

<button id="calculate">Get Estimate</button>
<div id="result"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
const SHEET_ID = "1n_U-hWDQKsF_2UHYcDfPJGYDQu64OHqWtD_DkGG78RI"; // your Google Sheet ID
const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=Sheet1`;

let vehicles = [];

Papa.parse(SHEET_URL, {
  download: true,
  header: true,
  complete: function(results) {
    vehicles = results.data.filter(r => r.Year);
    initDropdowns();
  }
});

function initDropdowns() {
  const yearSelect = document.getElementById('year');
  const makeSelect = document.getElementById('make');
  const modelSelect = document.getElementById('model');

  const years = [...new Set(vehicles.map(v => v.Year))].sort((a, b) => b - a);
  years.forEach(y => {
    const opt = document.createElement('option');
    opt.value = y;
    opt.text = y;
    yearSelect.appendChild(opt);
  });

  yearSelect.addEventListener('change', () => {
    const selectedYear = yearSelect.value;
    makeSelect.innerHTML = '<option value="">Select Make</option>';
    modelSelect.innerHTML = '<option value="">Select Model</option>';
    modelSelect.disabled = true;
    if (!selectedYear) { makeSelect.disabled = true; return; }
    makeSelect.disabled = false;
    const makes = [...new Set(vehicles.filter(v => v.Year == selectedYear).map(v => v.Make))].sort();
    makes.forEach(m => {
      const opt = document.createElement('option');
      opt.value = m;
      opt.text = m;
      makeSelect.appendChild(opt);
    });
  });

  makeSelect.addEventListener('change', () => {
    const selectedYear = yearSelect.value;
    const selectedMake = makeSelect.value;
    modelSelect.innerHTML = '<option value="">Select Model</option>';
    if (!selectedMake) { modelSelect.disabled = true; return; }
    modelSelect.disabled = false;
    const models = vehicles.filter(v => v.Year == selectedYear && v.Make == selectedMake).map(v => v.Model).sort();
    models.forEach(m => {
      const opt = document.createElement('option');
      opt.value = m;
      opt.text = m;
      modelSelect.appendChild(opt);
    });
  });

  document.getElementById('calculate').addEventListener('click', () => {
    const y = yearSelect.value;
    const mk = makeSelect.value;
    const md = modelSelect.value;
    const oil = document.getElementById('oilType').value;

    if (!y || !mk || !md) { alert('Please select Year, Make, and Model'); return; }

    const vehicle = vehicles.find(v => v.Year == y && v.Make == mk && v.Model == md);
    if (!vehicle) { alert('Vehicle not found'); return; }

    const qty = parseFloat(vehicle['OilCapacity']);
    const cost = parseFloat(vehicle[`Cost_${oil}`]);
    let price = qty * cost * 1.3; // 30% markup
    if (qty > 5) price += (qty - 5) * cost * 1.3; // overage
    document.getElementById('result').innerHTML = `Estimated Price: $${price.toFixed(2)} for ${qty} quarts of ${oil} oil.`;
  });
}
</script>

</body>
</html>
